(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{228:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"rightToc",(function(){return c})),t.d(n,"default",(function(){return u}));t(0);var r=t(396);function a(){return(a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o={title:"闭包的形",sidebar_label:"闭包的形"},c=[{value:"什么是闭包？",id:"什么是闭包？",children:[]}],b={rightToc:c},p="wrapper";function u(e){var n=e.components,t=l(e,["components"]);return Object(r.b)(p,a({},b,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"JS的文章中有很大一部分都是在讨论JS的闭包，闭包的概念在JS中确实是比较基础的，是你进阶深入了解JS的“通行证”，理解闭包，能让你的JS更上一层楼。"),Object(r.b)("p",null,"首先，我们得知道，到底什么样的代码我们可以称之为“闭包”？其次，闭包存在的价值是什么？要想理解闭包的价值得知道闭包产生的本质原因是什么，这也就涉及到JS引擎的垃圾回收（GC）机制。"),Object(r.b)("p",null,"取其神，忘其形。"),Object(r.b)("h2",{id:"什么是闭包？"},"什么是闭包？"),Object(r.b)("p",null,"是函数A里面嵌套函数B，而B又引用A中的变量，C又在引用B，导致C间接引用A，导致A不会被回收，这样的情形是闭包？"),Object(r.b)("p",null,"还是说，只要该函数被其他地方引用，内存不会被回收就是闭包？"),Object(r.b)("p",null,"Chrome中观察下面闭包："),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"function init() {\n   var foo = 'bar';\n   document.addEventListener('click', function () { foo = 'baz'; });\n}\n")),Object(r.b)("p",null,"init执行完，显然事件回调函数不能销毁，因为不然绑定事件不是白绑定了嘛？"),Object(r.b)("p",null,"要保证事件回调函数能正常执行，就不能销毁，它不能销毁，foo也不能销毁，foo不能销毁就要存（包）起来不让销毁，JS引擎就把foo存到了一个这个函数能访问到，但这个函数定义的域外无法访问的区域，这个区域就叫“闭包”。"),Object(r.b)("p",null,"闭包的形式是函数，函数的本质是作用域，故闭包的本质也是作用域。在chrome中也是放在scope里面。"),Object(r.b)("p",null,"其实，闭包无处不在，比如：jQuery、zepto的核心代码都包含在一个大的闭包中，所以下面我先写一个最简单最原始的闭包，以便让你在大脑里产生闭包的画面："),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),'function A(){\n    var str = "Hello Closure!";\n    function B(){  \n        console.log(str);  \n    }  \n    return B;  \n}  \nvar C = A();  \nC();//Hello Closure!\n')),Object(r.b)("p",null,"这是最简单的闭包。"),Object(r.b)("p",null,"有了初步认识后，我们简单分析一下它和普通函数有什么不同，上面代码翻译成自然语言如下："),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"定义普通函数 A"),Object(r.b)("li",{parentName:"ol"},"在 A 中定义普通函数 B"),Object(r.b)("li",{parentName:"ol"},"在 A 中返回 B"),Object(r.b)("li",{parentName:"ol"},"执行 A, 并把 A 的返回结果赋值给变量 C"),Object(r.b)("li",{parentName:"ol"},"执行 C"),Object(r.b)("li",{parentName:"ol"},"把这5步操作总结成一句话就是：")),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-text"}),"函数A的内部函数B被函数A外的一个变量 C 引用。\n")),Object(r.b)("p",null,"把这句话再加工一下就变成了闭包的定义："),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-text"}),"当一个内部函数被其外部函数之外的变量引用时，就形成了一个闭包。\n")),Object(r.b)("p",null,"因此，当你执行上述5步操作时，就已经定义了一个闭包！"),Object(r.b)("p",null,"这就是闭包。"),Object(r.b)("p",null,"另外要注意的是，最后不一定要return，只要调用内部函数也会产生闭包："),Object(r.b)("img",{src:"https://cosmos-x.oss-cn-hangzhou.aliyuncs.com/oqHTig.jpg"}))}u.isMDXComponent=!0},396:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return i}));var r=t(0),a=t.n(r),l=a.a.createContext({}),o=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):Object.assign({},n,e)),t},c=function(e){var n=o(e.components);return a.a.createElement(l.Provider,{value:n},e.children)};var b="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},u=Object(r.forwardRef)((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,c=e.parentName,b=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===n.indexOf(r)&&(t[r]=e[r]);return t}(e,["components","mdxType","originalType","parentName"]),u=o(t),i=r,s=u[c+"."+i]||u[i]||p[i]||l;return t?a.a.createElement(s,Object.assign({},{ref:n},b,{components:t})):a.a.createElement(s,Object.assign({},{ref:n},b))}));function i(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,o=new Array(l);o[0]=u;var c={};for(var p in n)hasOwnProperty.call(n,p)&&(c[p]=n[p]);c.originalType=e,c[b]="string"==typeof e?e:r,o[1]=c;for(var i=2;i<l;i++)o[i]=t[i];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);