(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{531:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return l})),t.d(n,"rightToc",(function(){return c})),t.d(n,"default",(function(){return u}));t(0);var r=t(546);function a(){return(a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}const l={id:"IndexedDB",title:"indexedDB",sidebar_label:"indexedDB"},c=[{value:"indexedDB",id:"indexeddb",children:[]},{value:"\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5e93",id:"\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5e93",children:[]},{value:"\u521b\u5efa\u4e00\u4e2a\u8868\uff1a\u5bf9\u8c61\u4ed3\u5e93",id:"\u521b\u5efa\u4e00\u4e2a\u8868\uff1a\u5bf9\u8c61\u4ed3\u5e93",children:[]},{value:"\u521b\u5efa\u4e8b\u52a1",id:"\u521b\u5efa\u4e8b\u52a1",children:[]},{value:"\u589e\u5220\u6539\u67e5",id:"\u589e\u5220\u6539\u67e5",children:[]},{value:"\u7d22\u5f15",id:"\u7d22\u5f15",children:[]}],s={rightToc:c},b="wrapper";function u({components:e,...n}){return Object(r.b)(b,a({},s,n,{components:e,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"indexeddb"},"indexedDB"),Object(r.b)("p",null,"IndexedDB(\u7d22\u5f15\u6570\u636e\u5e93) \u662f\u4e00\u4e2a\u4e3a\u4e86\u80fd\u591f\u5728\u6d4f\u89c8\u5668\u7aef\u5b58\u50a8\u5927\u91cf\u6570\u636e\uff0c\u53ef\u4ee5\u79bb\u7ebf\u4f7f\u7528\u548c\u4f7f\u7528\u7d22\u5f15\u8fdb\u884c\u9ad8\u6027\u80fd\u68c0\u7d22\u3002\u5176\u5b9e\u5b83\u5c31\u662f\u4e00\u4e2a\u57fa\u4e8e",Object(r.b)("strong",{parentName:"p"},"\u4e8b\u52a1\u64cd\u4f5c"),"\u7684key-value\u578b\u6570\u524d\u7aefNoSQL\u6570\u636e\u5e93\uff0c\u5176API\u662f\u5f02\u6b65\u7684\u3002\u57fa\u672c\u64cd\u4f5c\u5c31\u662f\uff0c\u6253\u5f00\u6570\u636e\u5e93\uff0c\u589e\u5220\u6539\u67e5\u3002"),Object(r.b)("p",null,"\u5e94\u7528\uff1a\n\u5927\u7684\u6570\u636e\u5728\u672c\u5730\u4e34\u65f6\u5b58\u50a8\uff0c\u6bd4\u5982\u8c37\u6b4c\u6587\u6863\u53ef\u80fd\u662f\u4e3a\u4e86\u79bb\u7ebf\u5b58\u50a8\uff0c\u5f85\u8054\u7f51\u7684\u65f6\u5019\u81ea\u52a8\u628a\u4fdd\u5b58\u672c\u5730\u7684\u66f4\u65b0\u5230\u670d\u52a1\u5668\u3002\n\u8054\u5408\u4f7f\u7528IndexedDB\u50a8\u5b58\u79bb\u7ebf\u6570\u636e\u548cService Workers\u50a8\u5b58\u79bb\u7ebf\u8d44\u6e90\uff0c\u5236\u4f5c\u79bb\u7ebfPWA\uff0c\u5982",Object(r.b)("a",a({parentName:"p"},{href:"https://h5.ele.me/%E3%80%82"}),"https://h5.ele.me/\u3002")),Object(r.b)("p",null,"IndexedDB \u5177\u6709\u4ee5\u4e0b\u7279\u70b9:"),Object(r.b)("p",null,'\uff081\uff09\u952e\u503c\u5bf9\u50a8\u5b58\u3002 IndexedDB \u5185\u90e8\u91c7\u7528\u5bf9\u8c61\u4ed3\u5e93\uff08object store\uff09\u5b58\u653e\u6570\u636e\u3002\u6240\u6709\u7c7b\u578b\u7684\u6570\u636e\u90fd\u53ef\u4ee5\u76f4\u63a5\u5b58\u5165\uff0c\u5305\u62ec JavaScript \u5bf9\u8c61\u3002\u5bf9\u8c61\u4ed3\u5e93\u4e2d\uff0c\u6570\u636e\u4ee5"\u952e\u503c\u5bf9"\u7684\u5f62\u5f0f\u4fdd\u5b58\uff0c\u6bcf\u4e00\u4e2a\u6570\u636e\u8bb0\u5f55\u90fd\u6709\u5bf9\u5e94\u7684\u4e3b\u952e\uff0c\u4e3b\u952e\u662f\u72ec\u4e00\u65e0\u4e8c\u7684\uff0c\u4e0d\u80fd\u6709\u91cd\u590d\uff0c\u5426\u5219\u4f1a\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002'),Object(r.b)("p",null,"\uff082\uff09\u5f02\u6b65\u3002 IndexedDB \u64cd\u4f5c\u65f6\u4e0d\u4f1a\u9501\u6b7b\u6d4f\u89c8\u5668\uff0c\u7528\u6237\u4f9d\u7136\u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\uff0c\u8fd9\u4e0e LocalStorage \u5f62\u6210\u5bf9\u6bd4\uff0c\u540e\u8005\u7684\u64cd\u4f5c\u662f\u540c\u6b65\u7684\u3002\u5f02\u6b65\u8bbe\u8ba1\u662f\u4e3a\u4e86\u9632\u6b62\u5927\u91cf\u6570\u636e\u7684\u8bfb\u5199\uff0c\u62d6\u6162\u7f51\u9875\u7684\u8868\u73b0\u3002"),Object(r.b)("p",null,"\uff083\uff09\u652f\u6301\u4e8b\u52a1\u3002 IndexedDB \u652f\u6301\u4e8b\u52a1\uff08transaction\uff09\uff0c\u8fd9\u610f\u5473\u7740\u4e00\u7cfb\u5217\u64cd\u4f5c\u6b65\u9aa4\u4e4b\u4e2d\uff0c\u53ea\u8981\u6709\u4e00\u6b65\u5931\u8d25\uff0c\u6574\u4e2a\u4e8b\u52a1\u5c31\u90fd\u53d6\u6d88\uff0c\u6570\u636e\u5e93\u56de\u6eda\u5230\u4e8b\u52a1\u53d1\u751f\u4e4b\u524d\u7684\u72b6\u6001\uff0c\u4e0d\u5b58\u5728\u53ea\u6539\u5199\u4e00\u90e8\u5206\u6570\u636e\u7684\u60c5\u51b5\u3002"),Object(r.b)("p",null,"\uff084\uff09\u540c\u6e90\u9650\u5236 IndexedDB \u53d7\u5230\u540c\u6e90\u9650\u5236\uff0c\u6bcf\u4e00\u4e2a\u6570\u636e\u5e93\u5bf9\u5e94\u521b\u5efa\u5b83\u7684\u57df\u540d\u3002\u7f51\u9875\u53ea\u80fd\u8bbf\u95ee\u81ea\u8eab\u57df\u540d\u4e0b\u7684\u6570\u636e\u5e93\uff0c\u800c\u4e0d\u80fd\u8bbf\u95ee\u8de8\u57df\u7684\u6570\u636e\u5e93\u3002"),Object(r.b)("p",null,"\uff085\uff09\u50a8\u5b58\u7a7a\u95f4\u5927 IndexedDB \u7684\u50a8\u5b58\u7a7a\u95f4\u6bd4 LocalStorage \u5927\u5f97\u591a\uff0c\u4e00\u822c\u6765\u8bf4\u4e0d\u5c11\u4e8e 250MB\uff0c\u751a\u81f3\u6ca1\u6709\u4e0a\u9650\u3002"),Object(r.b)("p",null,"\uff086\uff09\u652f\u6301\u4e8c\u8fdb\u5236\u50a8\u5b58\u3002 IndexedDB \u4e0d\u4ec5\u53ef\u4ee5\u50a8\u5b58\u5b57\u7b26\u4e32\uff0c\u8fd8\u53ef\u4ee5\u50a8\u5b58\u4e8c\u8fdb\u5236\u6570\u636e\uff08ArrayBuffer \u5bf9\u8c61\u548c Blob \u5bf9\u8c61\uff09\u3002"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"\u57fa\u672c\u539f\u7406\uff1a")),Object(r.b)("p",null,"\u8981\u5f02\u6b65\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u8981\u8c03\u7528 window \u5bf9\u8c61 indexedDB \u5c5e\u6027\u7684 open() \u65b9\u6cd5\u3002\u8be5\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a IDBRequest \u5bf9\u8c61 (IDBOpenDBRequest)\uff1b\u5f02\u6b65\u64cd\u4f5c\u901a\u8fc7\u5728 IDBRequest \u5bf9\u8c61\u4e0a\u89e6\u53d1\u4e8b\u4ef6\u6765\u548c\u8c03\u7528\u7a0b\u5e8f\u8fdb\u884c\u901a\u4fe1\u3002"),Object(r.b)("h2",{id:"\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5e93"},"\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5e93"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const request = indexedDB.open('myDatabase', 1);\nrequest.addEventListener('success', e => {\n    console.log('\u8fde\u63a5\u6570\u636e\u5e93\u6210\u529f');\n});\nrequest.addEventListener('error', e => {\n    console.log('\u8fde\u63a5\u6570\u636e\u5e93\u5931\u8d25');\n});\n")),Object(r.b)("p",null,"\u5728\u4e0a\u9762\u4ee3\u7801\u4e2d\u6211\u4eec\u4f7f\u7528 indexedDB.open() \u521b\u5efa\u4e00\u4e2aindexedDB\u6570\u636e\u5e93.open()\u65b9\u6cd5\u63a5\u53d7\u53ef\u4ee5\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff1a"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u6570\u636e\u5e93\u540d"),Object(r.b)("li",{parentName:"ul"},"\u6570\u636e\u5e93\u7684\u7248\u672c\u53f7")),Object(r.b)("p",null,"\u540c\u65f6\u8fd4\u56de\u4e00\u4e2aIDBOpenDBRequest\u5bf9\u8c61\u7528\u4e8e\u64cd\u4f5c\u6570\u636e\u5e93.\u5176\u4e2d\u5bf9\u4e8eopen()\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u6570\u636e\u5e93\u540d,open()\u4f1a\u5148\u53bb\u67e5\u627e\u672c\u5730\u662f\u5426\u5df2\u6709\u8fd9\u4e2a\u6570\u636e\u5e93,\u5982\u679c\u6709\u5219\u76f4\u63a5\u5c06\u8fd9\u4e2a\u6570\u636e\u5e93\u8fd4\u56de,\u5982\u679c\u6ca1\u6709,\u5219\u5148\u521b\u5efa\u8fd9\u4e2a\u6570\u636e\u5e93,\u518d\u8fd4\u56de.\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7248\u672c\u53f7,\u5219\u662f\u4e00\u4e2a\u53ef\u9009\u53c2\u6570,\u5982\u679c\u4e0d\u4f20,\u9ed8\u8ba4\u4e3a1.\u4f46\u5982\u679c\u4f20\u5165\u5c31\u5fc5\u987b\u662f\u4e00\u4e2a\u6574\u6570."),Object(r.b)("p",null,"\u5728\u901a\u8fc7\u5bf9indexedDB.open()\u65b9\u6cd5\u62ff\u5230\u4e00\u4e2a\u6570\u636e\u5e93\u5bf9\u8c61IDBOpenDBRequest\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u76d1\u542c\u8fd9\u4e2a\u5bf9\u8c61\u7684success\u4e8b\u4ef6\u548cerror\u4e8b\u4ef6\u6765\u6267\u884c\u76f8\u5e94\u7684\u64cd\u4f5c."),Object(r.b)("h2",{id:"\u521b\u5efa\u4e00\u4e2a\u8868\uff1a\u5bf9\u8c61\u4ed3\u5e93"},"\u521b\u5efa\u4e00\u4e2a\u8868\uff1a\u5bf9\u8c61\u4ed3\u5e93"),Object(r.b)("p",null,"\u6709\u4e86\u4e00\u4e2a\u6570\u636e\u5e93\u4e4b\u540e,\u6211\u4eec\u83b7\u53d6\u5c31\u60f3\u8981\u53bb\u5b58\u50a8\u6570\u636e\u4e86,\u4f46\u662f\u5355\u53ea\u6709\u6570\u636e\u5e93\u8fd8\u4e0d\u591f,\u6211\u4eec\u8fd8\u9700\u8981\u6709\u5bf9\u8c61\u4ed3\u5e93(object store).\u5bf9\u8c61\u4ed3\u5e93(object store)\u662findexedDB\u6570\u636e\u5e93\u7684\u57fa\u7840,\u5176\u7c7b\u4f3c\u4e8eMySQL\u4e2d\u8868\u7684\u6982\u5ff5."),Object(r.b)("p",null,"\u8981\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u4ed3\u5e93\u5fc5\u987b\u5728upgradeneeded\u4e8b\u4ef6\u4e2d,\u800cupgradeneeded\u4e8b\u4ef6\u53ea\u4f1a\u5728\u7248\u672c\u53f7\u66f4\u65b0\u7684\u65f6\u5019\u89e6\u53d1.\u8fd9\u662f\u56e0\u4e3aindexedDB API\u4e2d",Object(r.b)("strong",{parentName:"p"},"\u4e0d\u5141\u8bb8\u6570\u636e\u4ed3\u5e93\u5728\u540c\u4e00\u7248\u672c\u4e2d\u53d1\u751f\u53d8\u5316"),"\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const request = indexedDB.open('myDatabase', 2);\nrequest.addEventListener('upgradeneeded', e => {\n    const db = e.target.result;\n    const store = db.createObjectStore('Users', {\n        keyPath: 'userId',\n        autoIncrement: false\n    });\n    console.log('\u521b\u5efa\u5bf9\u8c61\u4ed3\u5e93\u6210\u529f');\n});\n")),Object(r.b)("p",null,"\u5728\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u6211\u4eec\u76d1\u542cupgradeneeded\u4e8b\u4ef6,\u5e76\u5728\u8fd9\u4e2a\u4e8b\u4ef6\u89e6\u53d1\u65f6\u4f7f\u7528createObjectStore()\u65b9\u6cd5\u521b\u5efa\u4e86\u4e00\u4e2a\u5bf9\u8c61\u4ed3\u5e93.createObjectStore()\u65b9\u6cd5\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff1a"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u5bf9\u8c61\u4ed3\u5e93\u7684\u540d\u5b57,\u5728\u540c\u4e00\u6570\u636e\u5e93\u4e2d,\u4ed3\u5e93\u540d\u4e0d\u80fd\u91cd\u590d"),Object(r.b)("li",{parentName:"ul"},"\u53ef\u9009\u53c2\u6570.\u7528\u4e8e\u6307\u5b9a\u6570\u636e\u7684\u4e3b\u952e,\u4ee5\u53ca\u662f\u5426\u81ea\u589e\u4e3b\u952e")),Object(r.b)("h2",{id:"\u521b\u5efa\u4e8b\u52a1"},"\u521b\u5efa\u4e8b\u52a1"),Object(r.b)("p",null,"\u7b80\u5355\u6765\u8bf4\u4e8b\u52a1\u5c31\u662f\u7528\u6765\u4fdd\u8bc1\u6570\u636e\u5e93\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u7684\u4e00\u4e2a\u9650\u5236\u3002"),Object(r.b)("p",null,"\u6bd4\u5982,\u5728\u4fee\u6539\u591a\u6761\u6570\u636e\u65f6,\u524d\u9762\u51e0\u6761\u5df2\u7ecf\u6210\u529f\u4e86.,\u5728\u4e2d\u95f4\u7684\u67d0\u4e00\u6761\u662f\u5931\u8d25\u4e86.\u90a3\u4e48\u5728\u8fd9\u65f6,\u5982\u679c\u662f\u57fa\u4e8e\u4e8b\u52a1\u7684\u6570\u636e\u5e93\u64cd\u4f5c,\u90a3\u4e48\u8fd9\u65f6\u6570\u636e\u5e93\u5c31\u5e94\u8be5\u91cd\u7f6e\u524d\u9762\u6570\u636e\u7684\u4fee\u6539,\u653e\u5f03\u540e\u9762\u7684\u6570\u636e\u4fee\u6539.\u76f4\u63a5\u8fd4\u56de\u9519\u8bef,\u4e00\u6761\u6570\u636e\u4e5f\u4e0d\u4fee\u6539\u3002"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const request = indexedDB.open('myDatabase', 3);\nrequest.addEventListener('success', e => {\n    const db = e.target.result;\n    const tx = db.transaction('Users', 'readwrite');\n});\n")),Object(r.b)("p",null,"\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u6211\u4eec\u4f7f\u7528transaction()\u6765\u521b\u5efa\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5b83\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff1a"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u4f60\u8981\u64cd\u4f5c\u7684\u5bf9\u8c61\u4ed3\u5e93\u540d\u79f0\u3002"),Object(r.b)("li",{parentName:"ul"},"\u4f60\u521b\u5efa\u7684\u4e8b\u52a1\u6a21\u5f0f\uff1a\u4f20\u5165 readonly\u65f6\u53ea\u80fd\u5bf9\u5bf9\u8c61\u4ed3\u5e93\u8fdb\u884c\u8bfb\u64cd\u4f5c\uff0c\u65e0\u6cd5\u5199\u64cd\u4f5c\u3002\u53ef\u4ee5\u4f20\u5165readwrite\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u3002")),Object(r.b)("h2",{id:"\u589e\u5220\u6539\u67e5"},"\u589e\u5220\u6539\u67e5"),Object(r.b)("p",null,"\u597d\u4e86\u73b0\u5728\u6709\u4e86\u6570\u636e\u5e93,\u5bf9\u8c61\u4ed3\u5e93,\u4e8b\u52a1\u4e4b\u540e\u6211\u4eec\u7ec8\u4e8e\u53ef\u4ee5\u5b58\u50a8\u6570\u636e\u4e86\uff1a"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"add() : \u589e\u52a0\u6570\u636e\u3002\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u4e3a\u9700\u8981\u4fdd\u5b58\u5230\u5bf9\u8c61\u4ed3\u5e93\u4e2d\u7684\u5bf9\u8c61\u3002"),Object(r.b)("li",{parentName:"ul"},"put() : \u589e\u52a0\u6216\u4fee\u6539\u6570\u636e\u3002\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u4e3a\u9700\u8981\u4fdd\u5b58\u5230\u5bf9\u8c61\u4ed3\u5e93\u4e2d\u7684\u5bf9\u8c61\u3002"),Object(r.b)("li",{parentName:"ul"},"get() : \u83b7\u53d6\u6570\u636e\u3002\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u4e3a\u9700\u8981\u83b7\u53d6\u6570\u636e\u7684\u4e3b\u952e\u503c\u3002"),Object(r.b)("li",{parentName:"ul"},"delete() : \u5220\u9664\u6570\u636e\u3002\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u4e3a\u9700\u8981\u83b7\u53d6\u6570\u636e\u7684\u4e3b\u952e\u503c\u3002")),Object(r.b)("p",null,"add \u548c put \u7684\u4f5c\u7528\u7c7b\u4f3c\uff0c\u533a\u522b\u5728\u4e8e put \u4fdd\u5b58\u6570\u636e\u65f6\uff0c\u5982\u679c\u8be5\u6570\u636e\u7684\u4e3b\u952e\u5728\u6570\u636e\u5e93\u4e2d\u5df2\u7ecf\u6709\u76f8\u540c\u4e3b\u952e\u7684\u65f6\u5019\uff0c\u5219\u4f1a\u4fee\u6539\u6570\u636e\u5e93\u4e2d\u5bf9\u5e94\u4e3b\u952e\u7684\u5bf9\u8c61\uff0c\u800c\u4f7f\u7528 add \u4fdd\u5b58\u6570\u636e\uff0c\u5982\u679c\u8be5\u4e3b\u952e\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u4fdd\u5b58\u5931\u8d25\u3002"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const request = indexedDB.open('myDatabase', 3);\nrequest.addEventListener('success', e => {\n    const db = e.target.result;\n    const tx = db.transaction('Users', 'readwrite');\n    const store = tx.objectStore('Users');\n    const reqAdd = store.add({\n        'userId': 1,\n        'userName': '\u674e\u767d',\n        'age': 24\n    });\n    const reqGet = store.get(1);\n    const reqDelete = store.delete(1);\n    reqAdd.addEventListener('success', e => {\n        console.log('\u64cd\u4f5c\u6210\u529f')  // delete \u540c\u7406\n    })\n    reqGet.addEventListener('success', e => {\n        console.log(this.result.userName);\n    })\n});\n")),Object(r.b)("p",null,"10.2.5 \u6e38\u6807\n\u5728\u4e0a\u9762\u5f53\u4e2d\u6211\u4eec\u4f7f\u7528get()\u65b9\u6cd5\u4f20\u5165\u4e00\u4e2a\u4e3b\u952e\u6765\u83b7\u53d6\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u6837\u53ea\u80fd\u591f\u83b7\u53d6\u5230\u4e00\u6761\u6570\u636e\u3002\u5982\u679c\u6211\u4eec\u60f3\u8981\u83b7\u53d6\u591a\u6761\u6570\u636e\u4e86\u600e\u4e48\u529e\uff1f",Object(r.b)("strong",{parentName:"p"},"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6e38\u6807\uff0c\u6765\u83b7\u53d6\u4e00\u4e2a\u533a\u95f4\u5185\u7684\u6570\u636e\u3002")),Object(r.b)("p",null,"\u8981\u4f7f\u7528\u6e38\u6807\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u5bf9\u8c61\u4ed3\u5e93\u4e0a\u7684 openCursor() \u65b9\u6cd5\u521b\u5efa\u5e76\u6253\u5f00 .openCursor() \u65b9\u6cd5\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"openCursor(\n  range?: IDBKeyRange | number | string | Date | IDBArrayKey,\n  direction?: IDBCursorDirection\n): IDBRequest;\n")),Object(r.b)("p",null,"\u7b2c\u4e00\u4e2a\u662f\u8303\u56f4\uff0c\u8303\u56f4\u53ef\u4ee5\u662f\u4e00\u4e2aIDBKeyRange\u5bf9\u8c61\uff0c\u7528\u4ee5\u4e0b\u65b9\u5f0f\u521b\u5efa\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"var boundRange = IDBKeyRange.bound(1, 10, false, false);\nvar onlyRange = IDBKeyRange.only(1);\nvar lowerRange = IDBKeyRange.lowerBound(1, false);\nvar upperRange = IDBKeyRange.upperBound(10, false);\n")),Object(r.b)("p",null,"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u65b9\u5411\uff0c\u4e3b\u8981\u6709\u4e00\u4e0b\u51e0\u79cd\uff1a"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"next : \u6e38\u6807\u4e2d\u7684\u6570\u636e\u6309\u4e3b\u952e\u503c\u5347\u5e8f\u6392\u5217\uff0c\u4e3b\u952e\u503c\u76f8\u7b49\u7684\u6570\u636e\u90fd\u88ab\u8bfb\u53d6"),Object(r.b)("li",{parentName:"ul"},"nextunique : \u6e38\u6807\u4e2d\u7684\u6570\u636e\u6309\u4e3b\u952e\u503c\u5347\u5e8f\u6392\u5217\uff0c\u4e3b\u952e\u503c\u76f8\u7b49\u53ea\u8bfb\u53d6\u7b2c\u4e00\u6761\u6570\u636e"),Object(r.b)("li",{parentName:"ul"},"prev : \u6e38\u6807\u4e2d\u7684\u6570\u636e\u6309\u4e3b\u952e\u503c\u964d\u5e8f\u6392\u5217\uff0c\u4e3b\u952e\u503c\u76f8\u7b49\u7684\u6570\u636e\u90fd\u88ab\u8bfb\u53d6"),Object(r.b)("li",{parentName:"ul"},"prevunique : \u6e38\u6807\u4e2d\u7684\u6570\u636e\u6309\u4e3b\u952e\u503c\u964d\u5e8f\u6392\u5217\uff0c\u4e3b\u952e\u503c\u76f8\u7b49\u53ea\u8bfb\u53d6\u7b2c\u4e00\u6761\u6570\u636e")),Object(r.b)("p",null,"\u4e0b\u9762\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5b8c\u6574\u7684\u4f8b\u5b50\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const request = indexedDB.open('myDatabase', 4);\nrequest.addEventListener('success', e => {\n    const db = e.target.result;\n    const tx = db.transaction('Users', 'readwrite');\n    const store = tx.objectStore('Users');\n    const range = IDBKeyRange.bound(1, 10);\n    const req = store.openCursor(range, 'next');\n    req.addEventListener('success', e => {\n        const cursor = this.result;\n        if (cursor) {\n            console.log(cursor.value.userName);\n            cursor.continue();\n        } else {\n            console.log('\u68c0\u7d22\u7ed3\u675f');\n        }\n    })\n});\n")),Object(r.b)("p",null,"\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u5982\u679c\u68c0\u7d22\u5230\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u65f6,\u6211\u4eec\u53ef\u4ee5:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u4f7f\u7528cursor.value\u62ff\u5230\u6570\u636e."),Object(r.b)("li",{parentName:"ul"},"\u4f7f\u7528cursor.updata()\u66f4\u65b0\u6570\u636e."),Object(r.b)("li",{parentName:"ul"},"\u4f7f\u7528cursor.delete()\u5220\u9664\u6570\u636e."),Object(r.b)("li",{parentName:"ul"},"\u4f7f\u7528cursor.continue()\u8bfb\u53d6\u4e0b\u4e00\u6761\u6570\u636e.")),Object(r.b)("h2",{id:"\u7d22\u5f15"},"\u7d22\u5f15"),Object(r.b)("p",null,"\u5728\u4e0a\u9762\u4ee3\u7801\u4e2d\u6211\u4eec\u83b7\u53d6\u6570\u636e\u90fd\u662f\u7528\u7684\u4e3b\u952e\u3002\u4f46\u662f\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\u6211\u4eec\u9700\u8981\u6570\u636e\u7684\u4e3b\u952e\u662f\u4ec0\u4e48\u3002\u6211\u4eec\u77e5\u9053\u4e00\u4e2a\u5927\u6982\u7684\u6761\u4ef6\uff0c\u6bd4\u5982\u8bf4\u5e74\u9f84\u5927\u4e8e20\u5c81\u7684\u7528\u6237\u3002\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u7528\u5230\u7d22\u5f15\uff0c\u4ee5\u4fbf\u6709\u6761\u4ef6\u7684\u67e5\u627e\u3002"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"\u521b\u5efa\u7d22\u5f15")),Object(r.b)("p",null,"\u6211\u4eec\u4f7f\u7528\u5bf9\u8c61\u4ed3\u5e93\u7684createIndex()\u65b9\u6cd5\u6765\u521b\u5efa\u4e00\u4e2a\u7d22\u5f15."),Object(r.b)("p",null,"createIndex(\nname: string,\nkeyPath: string | string[],\noptionalParameters?: IDBIndexParameters)\n: IDBIndex;"),Object(r.b)("p",null,"createIndex()\u65b9\u6cd5\u63a5\u6536\u4e09\u4e2a\u53c2\u6570:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"name\uff1a\u7d22\u5f15\u540d,\u4e0d\u80fd\u91cd\u590d."),Object(r.b)("li",{parentName:"ul"},"keyPath\uff1a\u4f60\u8981\u5728\u5b58\u50a8\u5bf9\u8c61\u4e0a\u7684\u90a3\u4e2a\u5c5e\u6027\u4e0a\u5efa\u7acb\u7d22\u5f15,\u53ef\u4ee5\u662f\u4e00\u4e2a\u5355\u4e2a\u7684key\u503c,\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5305\u542bkey\u503c\u96c6\u5408\u7684\u6570\u7ec4."),Object(r.b)("li",{parentName:"ul"},"optionalParameters\uff1a\u4e00\u4e2a\u53ef\u9009\u7684\u5bf9\u8c61\u53c2\u6570{unique, multiEntry}",Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},"unique: \u7528\u6765\u6307\u5b9a\u7d22\u5f15\u503c\u662f\u5426\u53ef\u4ee5\u91cd\u590d,\u4e3atrue\u4ee3\u8868\u4e0d\u80fd\u76f8\u540c,\u4e3afalse\u65f6\u4ee3\u8868\u53ef\u4ee5\u76f8\u540c"),Object(r.b)("li",{parentName:"ul"},"multiEntry: \u5f53\u7b2c\u4e8c\u4e2a\u53c2\u6570keyPath\u4e3a\u4e00\u4e2a\u6570\u7ec4\u65f6.\u5982\u679cmultiEntry\u662ftrue,\u5219\u4f1a\u4ee5\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u5efa\u7acb\u4e00\u6761\u7d22\u5f15.\u5982\u679c\u662ffalse,\u5219\u4ee5\u6574\u4e2a\u6570\u7ec4\u4e3akeyPath\u503c,\u6dfb\u52a0\u4e00\u6761\u7d22\u5f15.")))),Object(r.b)("p",null,"\u4e0b\u9762\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5b8c\u6574\u7684\u4f8b\u5b50,\u6211\u4eec\u5efa\u7acb\u4e00\u6761\u7528\u6237\u5e74\u9f84\u7684\u7d22\u5f15."),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const request = indexedDB.open('myDatabase', 5);\nrequest.addEventListener('upgradeneeded', e => {\n    const db = e.target.result;\n    const store = db.createObjectStore('Users', {\n        keyPath: 'userId',\n        autoIncrement: false\n    });\n    const idx = store.createIndex('ageIndex', 'age', {\n        unique: false\n    })\n});\n")),Object(r.b)("p",null,"\u8fd9\u6837\u6211\u4eec\u5c31\u521b\u5efa\u4e86\u4e00\u6761\u7d22\u5f15."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"\u4f7f\u7528\u7d22\u5f15")),Object(r.b)("p",null,"\u6211\u4eec\u4f7f\u7528\u5bf9\u8c61\u4ed3\u5e93\u4e0a\u7684index\u65b9\u6cd5,\u901a\u8fc7\u4f20\u5165\u4e00\u4e2a\u7d22\u5f15\u540d.\u6765\u62ff\u5230\u4e00\u4e2a\u7d22\u5f15\u5bf9\u8c61\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const index = store.index('ageIndex');\n")),Object(r.b)("p",null,"\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u7d22\u5f15\u4e86.\u6bd4\u5982\u8bf4\u6211\u4eec\u8981\u62ff\u5230\u5e74\u9f84\u572820\u5c81\u4ee5\u4e0a\u7684\u6570\u636e,\u5347\u5e8f\u6392\u5217."),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-js"}),"const request = indexedDB.open('myDatabase', 4);\nrequest.addEventListener('success', e => {\n    const db = e.target.result;\n    const tx = db.transaction('Users', 'readwrite');\n    const store = tx.objectStore('Users');\n    const index = store.index('ageIndex');\n    const req = index.openCursor(IDBKeyRange.lowerBound(20), 'next');\n    req.addEventListener('success', e => {\n        const cursor = e.target.result;\n        if (cursor) {\n            console.log(cursor.value.age);\n            cursor.continue();\n        } else {\n            console.log('\u68c0\u7d22\u7ed3\u675f');\n        }\n    })\n});\n")))}u.isMDXComponent=!0},546:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"b",(function(){return d}));var r=t(0),a=t.n(r),l=a.a.createContext({}),c=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):Object.assign({},n,e)),t},s=function(e){var n=c(e.components);return a.a.createElement(l.Provider,{value:n},e.children)};var b="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},o=Object(r.forwardRef)((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,b=function(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===n.indexOf(r)&&(t[r]=e[r]);return t}(e,["components","mdxType","originalType","parentName"]),o=c(t),d=r,p=o[s+"."+d]||o[d]||u[d]||l;return t?a.a.createElement(p,Object.assign({},{ref:n},b,{components:t})):a.a.createElement(p,Object.assign({},{ref:n},b))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,c=new Array(l);c[0]=o;var s={};for(var u in n)hasOwnProperty.call(n,u)&&(s[u]=n[u]);s.originalType=e,s[b]="string"==typeof e?e:r,c[1]=s;for(var d=2;d<l;d++)c[d]=t[d];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,t)}o.displayName="MDXCreateElement"}}]);